<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chi tiết đơn hàng</title>
	  <!-- Bootstrap 5 -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <link rel="stylesheet" th:href="@{/css/footer-chatbox-backtotop.css}">
  <link rel="stylesheet" th:href="@{/css/orderdetail.css}">
  <link rel="stylesheet" th:href="@{/css/header.css}">
</head>
<body>
<!-- Header -->
  <div th:replace="fragments/header :: siteHeader"></div>

    <div class="order-detail-container pb-5 pt-5">
        <div class="container ">
            <div class="card shadow-sm rounded-4 border-0">
                <div class="card-body p-4">
                    <h3 class="mb-4 fw-bold text-dark" >Đơn hàng #<span th:text="${order?.id}"></span></h3>

                    <!-- Thông báo -->
                    <div th:if="${message}" class="alert alert-success alert-dismissible fade show mb-4" role="alert" th:text="${message}">
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                    <div th:if="${error}" class="alert alert-danger alert-dismissible fade show mb-4" role="alert" th:text="${error}">
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>

                    <!-- Thông tin người nhận -->
                    <div th:if="${order}" class="row g-4 mb-4">
                        <div class="col-md-6">
                            <p class="mb-1 fw-semibold text-muted">Họ tên</p>
                            <p class="fs-5" th:text="${order.fullname} ?: 'Chưa cập nhật'"></p>

                            <p class="mb-1 fw-semibold text-muted">Số điện thoại</p>
                            <p class="fs-5" th:text="${order.phone} ?: 'Chưa cập nhật'"></p>

                            <p class="mb-1 fw-semibold text-muted">Địa chỉ</p>
                            <p class="fs-5" th:text="${order.address} ?: 'Chưa cập nhật'"></p>
                        </div>
                        <div class="col-md-6">
                            <p class="mb-1 fw-semibold text-muted">Phương thức thanh toán</p>
                            <p class="fs-5" th:text="${order.paymentMethod} ?: 'Chưa cập nhật'"></p>

                            <p class="mb-1 fw-semibold text-muted">Trạng thái</p>
                            <p class="fs-5" th:text="${@orderService.getVietnameseStatus(order.status) ?: 'Chưa cập nhật'}"></p>

                            <p class="mb-1 fw-semibold text-muted">Ngày đặt</p>
                            <p class="fs-5" th:text="${#dates.format(order.orderDate, 'dd/MM/yyyy HH:mm')} ?: 'Chưa xác định'"></p>
                        </div>
                    </div>

                    <!-- Danh sách sản phẩm -->
                    <div th:if="${order}" class="table-responsive">
                        <table class="table table-hover align-middle">
                            <thead class="table-light">
                                <tr>
                                    <th class="text-center">Sản phẩm</th>
                                    <th class="text-center">Ảnh</th>
                                    <th class="text-center">Size</th>
                                    <th class="text-center">Màu sắc</th>
                                    <th class="text-center">Số lượng</th>
                                    <th class="text-center">Đơn giá</th>
                                    <th class="text-center">Thành tiền</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="item : ${order.orderDetails}" class="text-center">
                                    <td th:text="${item?.variant?.product?.name} ?: 'Không có tên'" class="fw-medium"></td>
                                    <td>
                                        <img th:src="${#lists.size(item?.variant?.product?.images) > 0 ? item?.variant?.product?.images[0]?.imageUrl : '/images/default.jpg'}" alt="Ảnh sản phẩm"
                                             class="img-fluid rounded" style="width: 60px; height: 60px; object-fit: cover;">
                                    </td>
                                    <td th:text="${item?.variant?.size} ?: 'Chưa xác định'"></td>
                                    <td th:text="${item?.variant?.color} ?: 'Chưa xác định'"></td>
                                    <td th:text="${item?.quantity} ?: 0"></td>
                                    <td th:text="${#numbers.formatDecimal(item?.price, 0, 'COMMA', 2, 'POINT')} + ' VNĐ' ?: '0 VNĐ'"></td>
                                    <td th:text="${#numbers.formatDecimal(item?.price * item?.quantity, 0, 'COMMA', 2, 'POINT')} + ' VNĐ' ?: '0 VNĐ'"></td>
                                </tr>
                                <tr th:if="${#lists.isEmpty(order?.orderDetails)}">
                                    <td colspan="7" class="text-center text-muted">Không có sản phẩm trong đơn hàng này.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Tổng tiền -->
                    <div th:if="${order}" class="text-end mt-4">
                        <h5 class="fw-bold">
                            Tổng tiền:
                            <span class="text-danger" th:text="${#numbers.formatDecimal(order?.totalPrice, 0, 'COMMA', 2, 'POINT')} + ' VNĐ' ?: '0 VNĐ'"></span>
                        </h5>
                    </div>

                    <!-- Nút quay lại và hủy -->
                    <div class="mt-4">
                        <a th:href="@{/orders}" class="btn btn-outline-dark rounded-pill px-4">← Quay lại danh sách</a>
                        <form th:if="${order?.status == 'PENDING'}" th:action="@{'/orders/cancel/' + ${order.id}}" method="post" style="display:inline; margin-left: 10px;">
                            <button type="submit" class="btn btn-outline-danger rounded-pill px-4">
                                <i class="bi bi-x-circle"></i> Hủy đơn hàng
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

      <!-- Back to Top Button -->
  <button id="backToTop" title="Lên đầu trang">↑</button>
<script src="https://app.tudongchat.com/js/chatbox.js"></script>
<script>
  const tudong_chatbox = new TuDongChat('rcAWY0gPAIyrID6TbMt_5')
  tudong_chatbox.initial()
</script>
  <div th:replace="fragments/footer :: siteFooter"></div>
  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Custom JS -->
<!--   <script th:src="@{/js/home.js}"></script> -->
  <script type="module" src="/js/main.js"></script>
  <script type="module" src="/js/backtotop.js"></script>
</body>
</html>